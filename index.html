<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#f2f2f2">
    <title>Golf Stats</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        :root {
            --bg: #f2f2f2;
            --text: #1a1a1a;
            --text-light: #999;
            --text-lighter: #bbb;
            --text-faint: #ccc;
            --border: #e8e8e8;
            --border-light: #ddd;
            --card-bg: #fff;
            --good: #22c55e;
            --medium: #eab308;
            --bad: #ef4444;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            min-height: 100dvh;
            padding-bottom: 90px;
            -webkit-font-smoothing: antialiased;
        }
        
        /* Header */
        .header {
            padding: 16px 24px 12px;
            position: relative;
        }
        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        .app-name {
            font-size: 13px;
            color: var(--text-light);
            font-weight: 400;
        }
        .tagline {
            font-size: 9px;
            color: var(--text-lighter);
            font-style: italic;
            margin-top: 2px;
        }
        .greeting {
            font-size: 14px;
            color: var(--text);
            margin-top: 12px;
            font-weight: 400;
        }
        .profile-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #e8e8e8;
            border: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: var(--text);
            cursor: pointer;
        }
        .profile-btn.has-initial {
            background: var(--text);
            color: #fff;
            border: none;
            font-weight: 500;
            font-size: 13px;
        }
        
        /* Round in Progress Banner */
        .round-in-progress-banner {
            display: none;
            background: var(--text);
            color: #fff;
            padding: 12px 24px;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .round-in-progress-banner.show {
            display: flex;
        }
        .round-in-progress-text {
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .continue-scoring-btn {
            font-size: 12px;
            color: #fff;
            background: rgba(255,255,255,0.2);
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
        }
        .continue-scoring-btn:active {
            background: rgba(255,255,255,0.3);
        }
        
        /* Score Hero */
        .score-hero {
            padding: 0 24px;
            margin: 8px 0;
        }
        .score-hero-row {
            display: inline-flex;
            align-items: flex-start;
            gap: 4px;
        }
        .score-giant {
            font-size: 96px;
            font-weight: 300;
            letter-spacing: -6px;
            line-height: 0.85;
            color: var(--text);
        }
        .score-to-par {
            font-size: 18px;
            color: var(--text-lighter);
            font-weight: 400;
            margin-top: 8px;
        }
        .score-meta {
            font-size: 14px;
            color: var(--text-light);
            margin-top: 8px;
            padding: 0 24px;
        }
        
        .divider {
            height: 1px;
            background: var(--border-light);
            margin: 28px 24px;
        }
        
        /* Mini Stats */
        .mini-stats {
            display: flex;
            justify-content: space-between;
            padding: 0 24px;
        }
        .mini-stat { text-align: center; flex: 1; }
        .mini-stat-label {
            font-size: 10px;
            color: var(--text-lighter);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        .mini-stat-value {
            font-size: 20px;
            font-weight: 500;
            color: var(--text);
        }
        .mini-stat-value.good { color: var(--good); }
        .mini-stat-value.medium { color: var(--medium); }
        .mini-stat-value.bad { color: var(--bad); }
        .mini-stat-sub {
            font-size: 9px;
            color: var(--text-faint);
            margin-top: 2px;
        }
        
        /* Section */
        .section-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text);
            margin: 28px 24px 16px;
        }
        
        /* Buttons */
        .btn {
            display: block;
            width: calc(100% - 48px);
            margin: 0 24px;
            padding: 16px;
            border: none;
            font-family: inherit;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 12px;
            text-align: center;
        }
        .btn-primary {
            background: var(--text);
            color: #fff;
        }
        .btn-secondary {
            background: var(--card-bg);
            color: var(--text);
            border: 1px solid var(--border-light);
        }
        .btn:active { transform: scale(0.98); }
        .btn + .btn { margin-top: 12px; }
        
        /* List Items */
        .list-container { padding: 0 24px; }
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 0;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
        }
        .list-item:last-child { border-bottom: none; }
        .list-item-title {
            font-size: 15px;
            font-weight: 500;
            color: var(--text);
        }
        .list-item-sub {
            font-size: 12px;
            color: var(--text-lighter);
            margin-top: 2px;
        }
        .list-item-right { text-align: right; }
        .list-item-score {
            font-size: 32px;
            font-weight: 300;
            color: var(--text);
            letter-spacing: -1px;
        }
        .list-item-par {
            font-size: 12px;
            color: var(--text-light);
        }
        
        /* Navigation */
        .nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg);
            border-top: 1px solid #e0e0e0;
            display: flex;
            padding: 12px 20px calc(12px + env(safe-area-inset-bottom, 0px));
            z-index: 100;
        }
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: var(--text-lighter);
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
        }
        .nav-item.active { color: var(--text); }
        .nav-icon {
            width: 26px;
            height: 26px;
            border: 1.5px solid currentColor;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-style: normal;
        }
        .nav-item.active .nav-icon {
            background: var(--text);
            border-color: var(--text);
            color: #fff;
        }
        
        /* Tabs */
        .tab { display: none; }
        .tab.active { display: block; }
        
        /* Profile Page */
        .profile-page { display: none; padding: 0 24px; }
        .profile-page.active { display: block; }
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--text);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 300;
            margin: 24px auto;
        }
        .profile-avatar.empty {
            background: #e8e8e8;
            color: var(--text-light);
        }
        
        /* Form */
        .form-group { margin-bottom: 24px; }
        .form-label {
            font-size: 11px;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            display: block;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--border-light);
            border-radius: 12px;
            font-family: inherit;
            font-size: 16px;
            background: var(--card-bg);
            color: var(--text);
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--text);
        }
        
        /* Toggle */
        .toggle-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
        }
        .toggle-row:last-child { border-bottom: none; }
        .toggle-label {
            font-size: 15px;
            color: var(--text);
        }
        .toggle-sub {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 2px;
        }
        .toggle-switch {
            width: 50px;
            height: 30px;
            background: var(--border-light);
            border-radius: 15px;
            position: relative;
            cursor: pointer;
            transition: background 0.2s;
        }
        .toggle-switch.on { background: var(--good); }
        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 26px;
            height: 26px;
            background: #fff;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .toggle-switch.on::after { transform: translateX(20px); }
        
        /* Stats Tab */
        .filter-row {
            display: flex;
            gap: 8px;
            padding: 0 24px;
            margin-bottom: 16px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        .filter-row::-webkit-scrollbar { display: none; }
        .pill {
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 12px;
            color: var(--text-light);
            background: var(--card-bg);
            border: 1px solid var(--border-light);
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
        }
        .pill.active {
            background: var(--text);
            color: #fff;
            border-color: var(--text);
        }
        .rounds-badge {
            font-size: 11px;
            color: var(--text-light);
            padding: 0 24px;
            margin-bottom: 20px;
        }
        .rounds-badge span { color: var(--text); font-weight: 500; }
        
        .stats-header {
            display: flex;
            justify-content: space-between;
            padding: 0 24px 12px;
            font-size: 10px;
            color: var(--text-lighter);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--border);
        }
        .stats-header-right {
            display: flex;
            gap: 32px;
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 24px;
            border-bottom: 1px solid var(--border);
        }
        .stat-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .stat-icon {
            width: 28px;
            text-align: center;
            font-size: 14px;
            color: var(--text-light);
        }
        .stat-icon.emoji { font-size: 16px; }
        .stat-name {
            font-size: 14px;
            color: var(--text);
        }
        .stat-name-sub {
            font-size: 10px;
            color: var(--text-faint);
            margin-top: 1px;
        }
        .stat-right {
            display: flex;
            align-items: center;
            gap: 24px;
        }
        .stat-you-container { text-align: right; min-width: 50px; }
        .stat-you {
            font-size: 16px;
            font-weight: 500;
            color: var(--text);
        }
        .stat-you.good { color: var(--good); }
        .stat-you.medium { color: var(--medium); }
        .stat-you.bad { color: var(--bad); }
        .stat-you-sub {
            font-size: 10px;
            color: var(--text-faint);
            margin-top: 1px;
        }
        .stat-pga {
            font-size: 14px;
            color: var(--text-lighter);
            min-width: 40px;
            text-align: right;
        }
        
        /* Custom Date Filter */
        .custom-dates {
            display: none;
            padding: 0 24px 16px;
            gap: 12px;
        }
        .custom-dates.show { display: flex; }
        .custom-dates .form-group { flex: 1; margin-bottom: 0; }
        .custom-dates input[type="date"] {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            font-family: inherit;
            font-size: 14px;
            background: var(--card-bg);
        }
        
        /* Play Tab */
        .progress-bar {
            background: var(--text);
            padding: 16px 24px;
            margin-bottom: 0;
        }
        .progress-track {
            height: 3px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
        }
        .progress-fill {
            height: 100%;
            background: #fff;
            border-radius: 2px;
            transition: width 0.3s;
        }
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
        }
        .progress-text {
            font-size: 11px;
            color: rgba(255,255,255,0.6);
        }
        .live-score {
            font-size: 14px;
            font-weight: 600;
            color: #fff;
            background: rgba(255,255,255,0.15);
            padding: 4px 12px;
            border-radius: 12px;
        }
        
        /* Scorecard Expand */
        .scorecard-toggle {
            display: flex;
            justify-content: center;
            padding: 12px 24px;
            background: var(--bg);
        }
        .scorecard-toggle-btn {
            font-size: 12px;
            color: var(--text-light);
            background: none;
            border: 1px solid var(--border-light);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
        }
        .scorecard-toggle-btn:active {
            background: var(--border);
        }
        
        /* Classic Scorecard */
        .scorecard-container {
            display: none;
            padding: 0 16px 16px;
            overflow-x: auto;
        }
        .scorecard-container.show {
            display: block;
        }
        .classic-scorecard {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
            background: #fff;
            border: 1px solid #333;
        }
        .classic-scorecard th,
        .classic-scorecard td {
            border: 1px solid #999;
            padding: 6px 4px;
            text-align: center;
            min-width: 28px;
        }
        .classic-scorecard th {
            background: #f5f5f5;
            font-weight: 500;
            color: var(--text);
        }
        .classic-scorecard .hole-header {
            background: #333;
            color: #fff;
            font-weight: 600;
        }
        .classic-scorecard .par-row td {
            background: #f9f9f9;
            color: var(--text-light);
        }
        .classic-scorecard .score-cell {
            position: relative;
            font-weight: 500;
        }
        .classic-scorecard .birdie {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            border: 2px solid var(--good);
            border-radius: 50%;
            color: var(--good);
        }
        .classic-scorecard .eagle {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            border: 2px solid var(--good);
            border-radius: 50%;
            color: var(--good);
            box-shadow: 0 0 0 2px #fff, 0 0 0 4px var(--good);
        }
        .classic-scorecard .bogey {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            border: 2px solid var(--bad);
            color: var(--bad);
        }
        .classic-scorecard .double-bogey {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            border: 2px solid var(--bad);
            color: var(--bad);
            box-shadow: 0 0 0 2px #fff, 0 0 0 4px var(--bad);
        }
        .classic-scorecard .total-col {
            background: #f5f5f5;
            font-weight: 600;
        }
        .classic-scorecard .diff-cell {
            font-size: 10px;
            color: var(--text-light);
        }
        .classic-scorecard .diff-cell.under { color: var(--good); }
        .classic-scorecard .diff-cell.over { color: var(--bad); }
        
        .scoring-header {
            text-align: center;
            padding: 24px 0 20px;
        }
        .hole-label {
            font-size: 10px;
            color: var(--text-lighter);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        .hole-number {
            font-size: 72px;
            font-weight: 300;
            color: var(--text);
            margin: 4px 0;
            line-height: 1;
        }
        .hole-par {
            font-size: 14px;
            color: var(--text-light);
        }
        
        .score-input {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 32px;
            padding: 24px 24px 20px;
            background: var(--card-bg);
            border-radius: 16px;
            margin: 0 24px 16px;
        }
        .score-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: 1px solid var(--border-light);
            background: var(--card-bg);
            font-size: 24px;
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .score-btn:active { background: var(--border); }
        .score-current { text-align: center; }
        .score-current-num {
            font-size: 64px;
            font-weight: 300;
            color: var(--text);
        }
        .score-current-label {
            font-size: 13px;
            color: var(--text-light);
            margin-top: 4px;
        }
        .score-current-label.birdie { color: var(--good); }
        .score-current-label.eagle { color: var(--good); font-weight: 600; }
        .score-current-label.bogey { color: var(--medium); }
        .score-current-label.double-bogey { color: var(--bad); }
        
        /* Stat Cards */
        .stat-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 16px 20px;
            margin: 0 24px 12px;
        }
        .stat-card-title {
            font-size: 11px;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }
        .stat-card-subtitle {
            font-size: 10px;
            color: var(--text-faint);
            font-weight: normal;
            text-transform: none;
            letter-spacing: 0;
        }
        
        /* Yes/No Selection Buttons */
        .yes-no-row {
            display: flex;
            gap: 10px;
        }
        .yes-no-btn {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--border-light);
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            background: var(--card-bg);
            color: var(--text);
            cursor: pointer;
            transition: all 0.15s;
        }
        .yes-no-btn:active {
            transform: scale(0.98);
        }
        .yes-no-btn.selected-yes {
            background: #dcfce7;
            border-color: var(--good);
            color: var(--good);
        }
        .yes-no-btn.selected-no {
            background: #fee2e2;
            border-color: var(--bad);
            color: var(--bad);
        }
        .yes-no-btn.single {
            flex: 0 0 auto;
            padding: 10px 20px;
        }
        
        /* Putts Row */
        .putts-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .putts-label {
            font-size: 13px;
            color: var(--text);
        }
        .putts-buttons {
            display: flex;
            gap: 8px;
        }
        .putt-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid var(--border-light);
            background: var(--card-bg);
            font-size: 16px;
            color: var(--text);
            cursor: pointer;
        }
        .putt-btn.active {
            background: var(--text);
            color: #fff;
            border-color: var(--text);
        }
        
        /* Counter Input */
        .counter-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
        }
        .counter-label {
            font-size: 13px;
            color: var(--text);
        }
        .counter-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .counter-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1px solid var(--border-light);
            background: var(--card-bg);
            font-size: 18px;
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .counter-btn:active {
            background: var(--border);
        }
        .counter-value {
            font-size: 18px;
            font-weight: 500;
            min-width: 24px;
            text-align: center;
        }
        
        /* Conditional sections */
        .conditional-section {
            display: none;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }
        .conditional-section.show {
            display: block;
        }
        .sub-option {
            margin-bottom: 12px;
        }
        .sub-option:last-child {
            margin-bottom: 0;
        }
        .sub-option-label {
            font-size: 12px;
            color: var(--text-light);
            margin-bottom: 8px;
        }
        
        .play-nav {
            display: flex;
            gap: 12px;
            padding: 0 24px;
            margin-bottom: 12px;
        }
        .play-nav .btn { flex: 1; margin: 0; }
        
        /* Hole Grid */
        .hole-grid {
            display: none;
        }
        
        /* Course Setup */
        .setup-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            margin: 0 24px 16px;
        }
        .setup-card-title {
            font-size: 11px;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
        }
        
        /* Celebration */
        .celebration-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        .celebration-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }
        .celebration-popup {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 40px 48px;
            text-align: center;
            transform: scale(0.8);
            transition: transform 0.3s;
        }
        .celebration-overlay.show .celebration-popup {
            transform: scale(1);
        }
        .celebration-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }
        .celebration-text {
            font-size: 16px;
            color: var(--text-light);
            font-style: italic;
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        .modal-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }
        .modal {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 28px 24px;
            margin: 24px;
            max-width: 340px;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s;
        }
        .modal-overlay.show .modal {
            transform: scale(1);
        }
        .modal-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        .modal-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--text);
            margin-bottom: 12px;
            line-height: 1.4;
        }
        .modal-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        .modal-btn {
            flex: 1;
            padding: 14px;
            border-radius: 12px;
            font-family: inherit;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid var(--border-light);
            background: var(--card-bg);
            color: var(--text);
        }
        .modal-btn.primary {
            background: var(--text);
            color: #fff;
            border-color: var(--text);
        }
        .modal-btn:active {
            transform: scale(0.98);
        }
        
        /* Round Summary */
        .round-summary {
            display: none;
        }
        .round-summary.active {
            display: block;
        }
        .summary-header {
            text-align: center;
            padding: 24px;
            background: var(--text);
            color: #fff;
        }
        .summary-title {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.7;
            margin-bottom: 8px;
        }
        .summary-score {
            font-size: 64px;
            font-weight: 300;
        }
        .summary-to-par {
            font-size: 18px;
            opacity: 0.8;
            margin-top: 4px;
        }
        .summary-course {
            font-size: 14px;
            opacity: 0.6;
            margin-top: 12px;
        }
        .summary-section-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text);
            padding: 20px 24px 12px;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 24px;
            color: var(--text-light);
        }
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        /* Course Management */
        .course-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
        }
        .course-item:last-child { border-bottom: none; }
        .course-name { font-weight: 500; color: var(--text); }
        .course-par { font-size: 12px; color: var(--text-light); margin-top: 2px; }
        .course-delete {
            padding: 8px;
            cursor: pointer;
            opacity: 0.5;
        }
        .course-delete:hover { opacity: 1; }
        
        /* History Detail */
        .history-detail {
            display: none;
        }
        .history-detail.show {
            display: block;
        }
        .history-back {
            padding: 16px 24px;
            font-size: 14px;
            color: var(--text-light);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .history-back:active {
            color: var(--text);
        }
        .history-list-view {
            display: block;
        }
        .history-list-view.hide {
            display: none;
        }
    </style>
</head>
<body>
    <!-- ==================== HEADER ==================== -->
    <header class="header" id="mainHeader">
        <div class="header-row">
            <div>
                <div class="app-name">Lodge your stats</div>
                <div class="tagline">"Drive for show, putt for dough."</div>
                <div class="greeting" id="greeting"></div>
            </div>
            <div class="profile-btn" id="profileBtn" onclick="showProfile()">üë§</div>
        </div>
    </header>
    
    <header class="header" id="profileHeader" style="display:none;">
        <div class="app-name">Profile</div>
    </header>

    <!-- ==================== ROUND IN PROGRESS BANNER ==================== -->
    <div class="round-in-progress-banner" id="roundBanner">
        <span class="round-in-progress-text">‚õ≥ Round in Progress</span>
        <button class="continue-scoring-btn" onclick="continueScoring()">Continue scoring ‚Üí</button>
    </div>

    <!-- ==================== FUNNY MODAL ==================== -->
    <div class="modal-overlay" id="funnyModal">
        <div class="modal">
            <div class="modal-icon">üèåÔ∏è‚Äç‚ôÇÔ∏è</div>
            <div class="modal-title">Do you agree Will Lodge is a much better golfer than you? To accept and continue scoring, select 'Yes'</div>
            <div class="modal-buttons">
                <button class="modal-btn" onclick="closeFunnyModal()">No</button>
                <button class="modal-btn primary" onclick="acceptAndStartRound()">Yes</button>
            </div>
        </div>
    </div>

    <!-- ==================== PROFILE PAGE ==================== -->
    <div class="profile-page" id="profilePage">
        <div class="profile-avatar" id="profileAvatar">üë§</div>
        
        <div class="form-group">
            <label class="form-label">Your Name</label>
            <input type="text" class="form-input" id="inputName" placeholder="Enter your name">
        </div>
        
        <button class="btn btn-primary" onclick="saveName()">Save</button>
        
        <div class="section-title" style="margin-left:0;">Settings</div>
        
        <div class="toggle-row">
            <div>
                <div class="toggle-label">Sound Effects</div>
                <div class="toggle-sub">Birdie & eagle celebrations</div>
            </div>
            <div class="toggle-switch on" id="soundToggle" onclick="toggleSound()"></div>
        </div>
        
        <div class="section-title" style="margin-left:0;">Data</div>
        
        <div class="toggle-row" style="border-bottom:none;">
            <div>
                <div class="toggle-label">Backup & Restore</div>
                <div class="toggle-sub">Export or import your data</div>
            </div>
        </div>
        
        <button class="btn btn-secondary" onclick="exportData()" style="width:100%;margin:0 0 12px 0;">üì§ Export Backup</button>
        <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()" style="width:100%;margin:0;">üì• Import Backup</button>
        <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
        
        <button class="btn btn-secondary" onclick="hideProfile()" style="width:100%;margin:32px 0 0 0;">‚Üê Back to Home</button>
    </div>

    <!-- ==================== HOME TAB ==================== -->
    <div class="tab active" id="homeTab">
        <div class="score-hero" id="scoreHero">
            <div class="score-hero-row">
                <div class="score-giant" id="homeScore">--</div>
                <div class="score-to-par" id="homeToPar"></div>
            </div>
        </div>
        <div class="score-meta" id="homeMeta">No rounds yet</div>
        
        <div class="divider"></div>
        
        <div class="mini-stats">
            <div class="mini-stat">
                <div class="mini-stat-label">Fairways</div>
                <div class="mini-stat-value" id="homeFairways">--%</div>
                <div class="mini-stat-sub" id="homeFairwaysSub">&nbsp;</div>
            </div>
            <div class="mini-stat">
                <div class="mini-stat-label">GIR</div>
                <div class="mini-stat-value" id="homeGir">--%</div>
                <div class="mini-stat-sub" id="homeGirSub">&nbsp;</div>
            </div>
            <div class="mini-stat">
                <div class="mini-stat-label">Putts</div>
                <div class="mini-stat-value" id="homePutts">--</div>
                <div class="mini-stat-sub" id="homePuttsSub">&nbsp;</div>
            </div>
            <div class="mini-stat">
                <div class="mini-stat-label">üê¶ Birdies</div>
                <div class="mini-stat-value" id="homeBirdies">0</div>
                <div class="mini-stat-sub">&nbsp;</div>
            </div>
        </div>
        
        <div style="margin-top:28px;">
            <button class="btn btn-primary" onclick="showFunnyModal()">Start New Round</button>
        </div>
        
        <div class="section-title">Recent Rounds</div>
        <div class="list-container" id="recentRounds">
            <div class="empty-state">
                <div class="empty-state-icon">‚õ≥</div>
                <div>Play your first round!</div>
            </div>
        </div>
    </div>

    <!-- ==================== PLAY TAB ==================== -->
    <div class="tab" id="playTab">
        <!-- Setup View -->
        <div id="playSetup">
            <div class="setup-card">
                <div class="setup-card-title">Select Course</div>
                <select class="form-select" id="courseSelect" onchange="onCourseSelect()">
                    <option value="">Choose a course...</option>
                </select>
            </div>
            <button class="btn btn-primary" id="startRoundBtn" onclick="beginRound()" disabled>Start Round</button>
            <button class="btn btn-secondary" onclick="showTab('coursesTab')">+ Add New Course</button>
        </div>
        
        <!-- Active Round View -->
        <div id="playActive" style="display:none;">
            <!-- Progress Bar -->
            <div class="progress-bar">
                <div class="progress-track">
                    <div class="progress-fill" id="progressFill" style="width:5.5%;"></div>
                </div>
                <div class="progress-info">
                    <span class="progress-text" id="progressText">Hole 1 of 18</span>
                    <span class="live-score" id="liveScore">E</span>
                </div>
            </div>
            
            <!-- Scorecard Toggle -->
            <div class="scorecard-toggle">
                <button class="scorecard-toggle-btn" id="scorecardToggleBtn" onclick="toggleScorecard()">View Scorecard</button>
            </div>
            
            <!-- Classic Scorecard -->
            <div class="scorecard-container" id="scorecardContainer">
                <table class="classic-scorecard" id="classicScorecard"></table>
            </div>
            
            <!-- Hole Info -->
            <div class="scoring-header">
                <div class="hole-label">Hole</div>
                <div class="hole-number" id="currentHoleNum">1</div>
                <div class="hole-par" id="currentHolePar">Par 4</div>
            </div>
            
            <!-- Score Input -->
            <div class="score-input">
                <button class="score-btn" onclick="adjustScore(-1)">‚àí</button>
                <div class="score-current">
                    <div class="score-current-num" id="currentScore">4</div>
                    <div class="score-current-label" id="currentScoreLabel">Par</div>
                </div>
                <button class="score-btn" onclick="adjustScore(1)">+</button>
            </div>
            
            <!-- Fairway Hit (Par 4 and 5 only) -->
            <div class="stat-card" id="fairwayCard">
                <div class="stat-card-title">Fairway Hit?</div>
                <div class="yes-no-row">
                    <button class="yes-no-btn" id="fairwayYes" onclick="setFairway(true)">Yes</button>
                    <button class="yes-no-btn" id="fairwayNo" onclick="setFairway(false)">No</button>
                </div>
            </div>
            
            <!-- Putts -->
            <div class="stat-card">
                <div class="stat-card-title">Putts</div>
                <div class="putts-row">
                    <div class="putts-buttons" id="puttsButtons"></div>
                </div>
            </div>
            
            <!-- Gettable Putts -->
            <div class="stat-card">
                <div class="stat-card-title">Gettable Putts <span class="stat-card-subtitle">4-12ft</span></div>
                <div class="counter-row">
                    <span class="counter-label">Made (max 1)</span>
                    <div class="counter-controls">
                        <button class="counter-btn" onclick="adjustGettableMade(-1)">‚àí</button>
                        <span class="counter-value" id="gettableMadeValue">0</span>
                        <button class="counter-btn" onclick="adjustGettableMade(1)">+</button>
                    </div>
                </div>
                <div class="counter-row">
                    <span class="counter-label">Total attempts</span>
                    <div class="counter-controls">
                        <button class="counter-btn" onclick="adjustGettableTotal(-1)">‚àí</button>
                        <span class="counter-value" id="gettableTotalValue">0</span>
                        <button class="counter-btn" onclick="adjustGettableTotal(1)">+</button>
                    </div>
                </div>
            </div>
            
            <!-- Up & Down -->
            <div class="stat-card">
                <div class="stat-card-title">Up & Down <span class="stat-card-subtitle">&lt;15m from green</span></div>
                <div class="sub-option">
                    <div class="sub-option-label">Up & Down attempt?</div>
                    <button class="yes-no-btn single" id="upDownAttemptBtn" onclick="setUpDownAttempt()">Yes</button>
                </div>
                <div class="conditional-section" id="upDownDetails">
                    <div class="sub-option">
                        <div class="sub-option-label">Up & Down made?</div>
                        <div class="yes-no-row">
                            <button class="yes-no-btn" id="upDownMadeYes" onclick="setUpDownMade(true)">Yes</button>
                            <button class="yes-no-btn" id="upDownMadeNo" onclick="setUpDownMade(false)">No</button>
                        </div>
                    </div>
                    <div class="sub-option">
                        <div class="sub-option-label">From bunker?</div>
                        <button class="yes-no-btn single" id="fromBunkerBtn" onclick="setFromBunker()">Yes</button>
                    </div>
                </div>
            </div>
            
            <!-- Navigation -->
            <div class="play-nav">
                <button class="btn btn-secondary" onclick="prevHole()">‚Üê Prev</button>
                <button class="btn btn-primary" id="nextHoleBtn" onclick="nextHole()">Next ‚Üí</button>
            </div>
            
            <!-- Finish Round - moved lower with more spacing -->
            <div style="height: 24px;"></div>
            <button class="btn btn-secondary" onclick="finishRound()" style="margin-top:0;">Finish Round</button>
            <div style="height: 20px;"></div>
        </div>
    </div>

    <!-- ==================== STATS TAB ==================== -->
    <div class="tab" id="statsTab">
        <div class="header">
            <div class="app-name">Statistics</div>
        </div>
        
        <div class="filter-row">
            <div class="pill active" data-filter="3m" onclick="setFilter('3m')">3 Months</div>
            <div class="pill" data-filter="6m" onclick="setFilter('6m')">6 Months</div>
            <div class="pill" data-filter="1y" onclick="setFilter('1y')">Year</div>
            <div class="pill" data-filter="all" onclick="setFilter('all')">All Time</div>
            <div class="pill" data-filter="custom" onclick="setFilter('custom')">Custom</div>
        </div>
        
        <div class="custom-dates" id="customDates">
            <div class="form-group">
                <label class="form-label">From</label>
                <input type="date" id="filterFrom" onchange="applyCustomFilter()">
            </div>
            <div class="form-group">
                <label class="form-label">To</label>
                <input type="date" id="filterTo" onchange="applyCustomFilter()">
            </div>
        </div>
        
        <div class="rounds-badge">Based on <span id="statsRoundsCount">0</span> rounds played</div>
        
        <div class="stats-header">
            <span>Stat</span>
            <div class="stats-header-right">
                <span>You</span>
                <span>PGA</span>
            </div>
        </div>
        
        <div id="statsRows"></div>
    </div>

    <!-- ==================== HISTORY TAB ==================== -->
    <div class="tab" id="historyTab">
        <div class="header">
            <div class="app-name">History</div>
        </div>
        <div class="history-list-view" id="historyListView">
            <div class="list-container" id="historyList"></div>
        </div>
        <div class="history-detail" id="historyDetail">
            <div class="history-back" onclick="hideHistoryDetail()">‚Üê Back to History</div>
            <div id="historyDetailContent"></div>
        </div>
    </div>

    <!-- ==================== ROUND SUMMARY ==================== -->
    <div class="round-summary" id="roundSummary">
        <div class="summary-header">
            <div class="summary-title">Round Complete</div>
            <div class="summary-score" id="summaryScore">--</div>
            <div class="summary-to-par" id="summaryToPar"></div>
            <div class="summary-course" id="summaryCourse"></div>
        </div>
        <div class="summary-section-title">Scorecard</div>
        <div class="scorecard-container show" style="margin-bottom:0;">
            <table class="classic-scorecard" id="summaryScorecard"></table>
        </div>
        <div class="summary-section-title">Statistics</div>
        <div id="summaryStats" style="padding: 0 24px 24px;"></div>
        <button class="btn btn-primary" onclick="closeSummary()" style="margin-bottom: 24px;">Done</button>
    </div>

    <!-- ==================== COURSES TAB ==================== -->
    <div class="tab" id="coursesTab">
        <div class="header">
            <div class="app-name">Courses</div>
        </div>
        
        <div class="setup-card">
            <div class="setup-card-title">Add New Course</div>
            <div class="form-group" style="margin-bottom:16px;">
                <input type="text" class="form-input" id="newCourseName" placeholder="Course name">
            </div>
            <div class="form-group" style="margin-bottom:16px;">
                <input type="text" class="form-input" id="newCoursePars" placeholder="Pars (e.g., 4,3,5,4,4,3,4,5,4...)">
            </div>
            <button class="btn btn-primary" onclick="addCourse()" style="width:100%;margin:0;">Add Course</button>
        </div>
        
        <div class="section-title">Your Courses</div>
        <div class="list-container" id="coursesList"></div>
    </div>

    <!-- ==================== NAVIGATION ==================== -->
    <nav class="nav" id="mainNav">
        <div class="nav-item active" onclick="showTab('homeTab')">
            <div class="nav-icon">‚åÇ</div>
            Home
        </div>
        <div class="nav-item" onclick="showTab('playTab')">
            <div class="nav-icon">‚ñ∂</div>
            Play
        </div>
        <div class="nav-item" onclick="showTab('statsTab')">
            <div class="nav-icon">‚â°</div>
            Stats
        </div>
        <div class="nav-item" onclick="showTab('historyTab')">
            <div class="nav-icon">‚Ü∫</div>
            History
        </div>
        <div class="nav-item" onclick="showTab('coursesTab')">
            <div class="nav-icon">‚öë</div>
            Courses
        </div>
    </nav>

    <!-- ==================== CELEBRATION ==================== -->
    <div class="celebration-overlay" id="celebration">
        <div class="celebration-popup">
            <div class="celebration-icon" id="celebrationIcon">üê¶</div>
            <div class="celebration-text" id="celebrationText">"Tweet tweet"</div>
        </div>
    </div>

    <!-- ==================== AUDIO ==================== -->
    <audio id="birdieSound" preload="auto"></audio>
    <audio id="eagleSound" preload="auto"></audio>

    <script>
        // Audio files (base64 encoded short chirps)
        const BIRDIE_AUDIO = 'data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAAAAAAAAAAAAYYNBqSRAAAAAAD/+9DEAAAIAANIAAAAQlgA0g8AAABEREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREf/7cMQFgApoA1B4AAAAAAAA0gAAAERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERH/+3DEBYAKAANQeAAAAAAAANIAAAARERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERE//twxAaACgADSHgAAAAAAA0gAAABEREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREQ==';
        const EAGLE_AUDIO = 'data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAAAAAAAAAAAAYYNBqSRAAAAAAD/+9DEAAAIAANIAAAAQlgA0g8AAABEREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREf/7cMQFgApoA1B4AAAAAAAA0gAAAERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERH/+3DEBYAKAANQeAAAAAAAANIAAAARERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERE//twxAaACgADSHgAAAAAAA0gAAABEREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREQ==';
        
        // Initialize audio
        document.getElementById('birdieSound').src = BIRDIE_AUDIO;
        document.getElementById('eagleSound').src = EAGLE_AUDIO;
        
        // ==================== APP STATE ====================
        let state = {
            profile: { name: '', soundEnabled: true },
            courses: [
                { id: 1, name: 'üåπüêê (North)', pars: [4,4,4,3,4,4,3,4,5,4,3,4,3,4,5,5,4,4] },
                { id: 2, name: 'üåπüêê (South)', pars: [4,5,4,3,5,4,4,3,4,4,5,3,4,3,4,4,5,4] },
                { id: 3, name: 'Yas Links', pars: [4,5,4,3,4,4,5,3,4,4,5,4,3,4,4,4,3,5] }
            ],
            rounds: [],
            currentRound: null
        };
        
        let currentHoleIndex = 0;
        let currentFilter = '3m';
        let scorecardVisible = false;
        let pendingCelebration = null;
        
        // ==================== STORAGE ====================
        function loadState() {
            const defaultCourses = [
                { id: 1, name: 'üåπüêê (North)', pars: [4,4,4,3,4,4,3,4,5,4,3,4,3,4,5,5,4,4] },
                { id: 2, name: 'üåπüêê (South)', pars: [4,5,4,3,5,4,4,3,4,4,5,3,4,3,4,4,5,4] },
                { id: 3, name: 'Yas Links', pars: [4,5,4,3,4,4,5,3,4,4,5,4,3,4,4,4,3,5] }
            ];
            
            try {
                const saved = localStorage.getItem('golfStatsAppV2');
                if (saved) {
                    state = JSON.parse(saved);
                    // Ensure default courses exist
                    defaultCourses.forEach(dc => {
                        if (!state.courses.find(c => c.name === dc.name)) {
                            state.courses.unshift(dc);
                        }
                    });
                    // Migrate old data - add new fields if missing
                    if (state.currentRound) {
                        state.currentRound.holes.forEach(h => {
                            if (h.gettableMade === undefined) h.gettableMade = 0;
                            if (h.gettableTotal === undefined) h.gettableTotal = h.gettable ? 1 : 0;
                            if (h.upDownAttempt === undefined) h.upDownAttempt = !h.gir;
                            if (h.upDownMade === undefined) h.upDownMade = h.upDown || null;
                            if (h.fromBunker === undefined) h.fromBunker = h.sand || false;
                        });
                    }
                    state.rounds.forEach(r => {
                        r.holes.forEach(h => {
                            if (h.gettableMade === undefined) h.gettableMade = h.gettable && h.gettableMade !== false ? 1 : 0;
                            if (h.gettableTotal === undefined) h.gettableTotal = h.gettable ? 1 : 0;
                            if (h.upDownAttempt === undefined) h.upDownAttempt = !h.gir;
                            if (h.upDownMade === undefined) h.upDownMade = h.upDown || null;
                            if (h.fromBunker === undefined) h.fromBunker = h.sand || false;
                        });
                    });
                }
            } catch (e) { console.error('Load error:', e); }
            
            // Request persistent storage
            if (navigator.storage && navigator.storage.persist) {
                navigator.storage.persist();
            }
        }
        
        function saveState() {
            try {
                localStorage.setItem('golfStatsAppV2', JSON.stringify(state));
            } catch (e) { console.error('Save error:', e); }
        }
        
        function exportData() {
            const blob = new Blob([JSON.stringify(state, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `golf-stats-backup-${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    state = JSON.parse(e.target.result);
                    saveState();
                    alert('Data imported successfully!');
                    location.reload();
                } catch (err) {
                    alert('Error importing: ' + err.message);
                }
            };
            reader.readAsText(file);
        }
        
        // ==================== PROFILE ====================
        function showProfile() {
            document.getElementById('mainHeader').style.display = 'none';
            document.getElementById('profileHeader').style.display = 'block';
            document.getElementById('profilePage').classList.add('active');
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById('mainNav').style.display = 'none';
            document.getElementById('roundBanner').classList.remove('show');
            
            document.getElementById('inputName').value = state.profile.name || '';
            updateProfileAvatar();
            document.getElementById('soundToggle').classList.toggle('on', state.profile.soundEnabled !== false);
        }
        
        function hideProfile() {
            document.getElementById('mainHeader').style.display = 'block';
            document.getElementById('profileHeader').style.display = 'none';
            document.getElementById('profilePage').classList.remove('active');
            document.getElementById('mainNav').style.display = 'flex';
            showTab('homeTab');
        }
        
        function saveName() {
            state.profile.name = document.getElementById('inputName').value.trim();
            saveState();
            updateGreeting();
            updateProfileBtn();
            updateProfileAvatar();
            hideProfile();
        }
        
        function toggleSound() {
            state.profile.soundEnabled = !state.profile.soundEnabled;
            document.getElementById('soundToggle').classList.toggle('on', state.profile.soundEnabled);
            saveState();
        }
        
        function updateGreeting() {
            const el = document.getElementById('greeting');
            if (!state.profile.name) {
                el.textContent = '';
                return;
            }
            const hour = new Date().getHours();
            let greeting = hour < 12 ? 'Good morning' : hour < 17 ? 'Good afternoon' : 'Good evening';
            el.textContent = `${greeting}, ${state.profile.name}`;
        }
        
        function updateProfileBtn() {
            const btn = document.getElementById('profileBtn');
            if (state.profile.name) {
                btn.textContent = state.profile.name.charAt(0).toUpperCase();
                btn.classList.add('has-initial');
            } else {
                btn.textContent = 'üë§';
                btn.classList.remove('has-initial');
            }
        }
        
        function updateProfileAvatar() {
            const avatar = document.getElementById('profileAvatar');
            if (state.profile.name) {
                avatar.textContent = state.profile.name.charAt(0).toUpperCase();
                avatar.classList.remove('empty');
            } else {
                avatar.textContent = 'üë§';
                avatar.classList.add('empty');
            }
        }
        
        // ==================== FUNNY MODAL ====================
        function showFunnyModal() {
            document.getElementById('funnyModal').classList.add('show');
        }
        
        function closeFunnyModal() {
            document.getElementById('funnyModal').classList.remove('show');
        }
        
        function acceptAndStartRound() {
            closeFunnyModal();
            startNewRound();
        }
        
        // ==================== ROUND IN PROGRESS BANNER ====================
        function updateRoundBanner(tabId) {
            const banner = document.getElementById('roundBanner');
            if (state.currentRound && tabId !== 'playTab') {
                banner.classList.add('show');
            } else {
                banner.classList.remove('show');
            }
        }
        
        function continueScoring() {
            // Find first unscored hole (hole where score equals par - meaning untouched)
            if (state.currentRound) {
                let firstUnscored = 0;
                for (let i = 0; i < state.currentRound.holes.length; i++) {
                    const h = state.currentRound.holes[i];
                    // Consider a hole "unscored" if it still has default values
                    if (h.score === h.par && h.putts === 2 && !h.fairway && !h.upDownAttempt) {
                        firstUnscored = i;
                        break;
                    }
                    firstUnscored = i + 1;
                }
                currentHoleIndex = Math.min(firstUnscored, 17);
            }
            showTab('playTab');
        }
        
        // ==================== NAVIGATION ====================
        function showTab(tabId) {
            // Hide round summary if showing
            document.getElementById('roundSummary').classList.remove('active');
            document.getElementById('mainNav').style.display = 'flex';
            document.getElementById('mainHeader').style.display = tabId === 'playTab' && state.currentRound ? 'none' : 'block';
            
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            
            const navMap = { homeTab: 0, playTab: 1, statsTab: 2, historyTab: 3, coursesTab: 4 };
            document.querySelectorAll('.nav-item')[navMap[tabId]].classList.add('active');
            
            updateRoundBanner(tabId);
            
            if (tabId === 'homeTab') updateHomeTab();
            if (tabId === 'statsTab') updateStatsTab();
            if (tabId === 'historyTab') updateHistoryTab();
            if (tabId === 'playTab') updatePlayTab();
            if (tabId === 'coursesTab') updateCoursesTab();
        }
        
        // ==================== HOME TAB ====================
        function updateHomeTab() {
            updateGreeting();
            updateProfileBtn();
            
            if (state.rounds.length === 0) {
                document.getElementById('homeScore').textContent = '--';
                document.getElementById('homeToPar').textContent = '';
                document.getElementById('homeMeta').textContent = 'No rounds yet';
                document.getElementById('homeFairways').textContent = '--%';
                document.getElementById('homeFairwaysSub').innerHTML = '&nbsp;';
                document.getElementById('homeGir').textContent = '--%';
                document.getElementById('homeGirSub').innerHTML = '&nbsp;';
                document.getElementById('homePutts').textContent = '--';
                document.getElementById('homePuttsSub').innerHTML = '&nbsp;';
                document.getElementById('homeBirdies').textContent = '0';
                document.getElementById('recentRounds').innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚õ≥</div><div>Play your first round!</div></div>';
                return;
            }
            
            // Last round
            const lastRound = state.rounds[state.rounds.length - 1];
            document.getElementById('homeScore').textContent = lastRound.totalScore || '--';
            
            const course = state.courses.find(c => c.id === lastRound.courseId);
            const coursePar = course ? course.pars.reduce((a,b) => a+b, 0) : 72;
            const toPar = lastRound.totalScore - coursePar;
            document.getElementById('homeToPar').textContent = toPar === 0 ? 'E' : (toPar > 0 ? '+' + toPar : toPar);
            
            const date = new Date(lastRound.date);
            const dateStr = date.toLocaleDateString('en-US', { day: 'numeric', month: 'short' });
            document.getElementById('homeMeta').textContent = `Last round ¬∑ ${lastRound.courseName} ¬∑ ${dateStr}`;
            
            // Calculate stats from last round
            const stats = calculateRoundStats(lastRound);
            
            document.getElementById('homeFairways').textContent = stats.fwPct !== null ? stats.fwPct + '%' : '--%';
            document.getElementById('homeFairways').className = 'mini-stat-value ' + getColorClass(stats.fwPct, 60);
            document.getElementById('homeFairwaysSub').textContent = stats.fwTotal > 0 ? `${stats.fwHit} of ${stats.fwTotal}` : '';
            
            document.getElementById('homeGir').textContent = stats.girPct !== null ? stats.girPct + '%' : '--%';
            document.getElementById('homeGir').className = 'mini-stat-value ' + getColorClass(stats.girPct, 66);
            document.getElementById('homeGirSub').textContent = stats.girTotal > 0 ? `${stats.girHit} of ${stats.girTotal}` : '';
            
            document.getElementById('homePutts').textContent = stats.totalPutts || '--';
            document.getElementById('homePutts').className = 'mini-stat-value ' + getColorClassInverse(stats.totalPutts, 29);
            document.getElementById('homePuttsSub').textContent = stats.totalPutts ? (stats.totalPutts / 18).toFixed(2) + '/hole' : '';
            
            document.getElementById('homeBirdies').textContent = stats.birdies;
            
            // Recent rounds
            const recent = [...state.rounds].reverse().slice(0, 5);
            document.getElementById('recentRounds').innerHTML = recent.map((r, idx) => {
                const c = state.courses.find(x => x.id === r.courseId);
                const par = c ? c.pars.reduce((a,b)=>a+b,0) : 72;
                const tp = r.totalScore - par;
                const tpStr = tp === 0 ? 'E' : (tp > 0 ? '+' + tp : tp);
                const d = new Date(r.date);
                return `<div class="list-item" onclick="showRoundDetail(${state.rounds.length - 1 - idx})">
                    <div>
                        <div class="list-item-title">${r.courseName}</div>
                        <div class="list-item-sub">${d.toLocaleDateString('en-US', { day: 'numeric', month: 'short', year: 'numeric' })}</div>
                    </div>
                    <div class="list-item-right">
                        <div class="list-item-score">${r.totalScore || '--'}</div>
                        <div class="list-item-par">${tpStr}</div>
                    </div>
                </div>`;
            }).join('');
        }
        
        function calculateRoundStats(round) {
            let fwHit = 0, fwTotal = 0, girHit = 0, girTotal = 0, totalPutts = 0, birdies = 0, eagles = 0;
            let udMade = 0, udAttempts = 0;
            let gettableMade = 0, gettableTotal = 0;
            let threePutts = 0;
            let scrambleSuccess = 0, scrambleAttempts = 0;
            
            round.holes.forEach(h => {
                if (h.score === null) return;
                
                const diff = h.score - h.par;
                if (diff === -1) birdies++;
                if (diff <= -2) eagles++;
                
                // Auto-calculate GIR
                const gir = calculateGIR(h.score, h.putts, h.par);
                girTotal++;
                if (gir) girHit++;
                
                if (h.par >= 4) {
                    fwTotal++;
                    if (h.fairway) fwHit++;
                }
                
                if (h.putts !== null) {
                    totalPutts += h.putts;
                    if (h.putts >= 3) threePutts++;
                }
                
                // Up & down stats
                if (h.upDownAttempt) {
                    udAttempts++;
                    if (h.upDownMade === true) udMade++;
                }
                
                // Gettable putts
                gettableTotal += h.gettableTotal || 0;
                gettableMade += h.gettableMade || 0;
                
                // Scrambling: par or better after missing GIR
                if (!gir) {
                    scrambleAttempts++;
                    if (diff <= 0) scrambleSuccess++;
                }
            });
            
            return {
                fwHit, fwTotal,
                fwPct: fwTotal > 0 ? Math.round(fwHit / fwTotal * 100) : null,
                girHit, girTotal,
                girPct: girTotal > 0 ? Math.round(girHit / girTotal * 100) : null,
                totalPutts: totalPutts || null,
                puttsPerHole: girTotal > 0 ? (totalPutts / girTotal).toFixed(2) : null,
                birdies, eagles,
                udMade, udAttempts,
                udPct: udAttempts > 0 ? Math.round(udMade / udAttempts * 100) : null,
                gettableMade, gettableTotal,
                gettablePct: gettableTotal > 0 ? Math.round(gettableMade / gettableTotal * 100) : null,
                threePutts,
                scrambleSuccess, scrambleAttempts,
                scramblePct: scrambleAttempts > 0 ? Math.round(scrambleSuccess / scrambleAttempts * 100) : null
            };
        }
        
        function calculateGIR(score, putts, par) {
            // GIR = reached green in (par - 2) strokes or fewer
            // If score - putts <= par - 2, then GIR
            if (score === null || putts === null) return false;
            return (score - putts) <= (par - 2);
        }
        
        function getColorClass(value, threshold) {
            if (value === null) return '';
            if (value >= threshold) return 'good';
            if (value >= threshold * 0.7) return 'medium';
            return 'bad';
        }
        
        function getColorClassInverse(value, threshold) {
            if (value === null) return '';
            if (value <= threshold) return 'good';
            if (value <= threshold * 1.2) return 'medium';
            return 'bad';
        }
        
        // ==================== STATS TAB ====================
        function setFilter(filter) {
            currentFilter = filter;
            document.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
            document.querySelector(`.pill[data-filter="${filter}"]`).classList.add('active');
            
            document.getElementById('customDates').classList.toggle('show', filter === 'custom');
            
            if (filter !== 'custom') {
                updateStatsTab();
            }
        }
        
        function applyCustomFilter() {
            if (currentFilter === 'custom') {
                updateStatsTab();
            }
        }
        
        function getFilteredRounds() {
            const now = new Date();
            let fromDate;
            
            if (currentFilter === 'custom') {
                const from = document.getElementById('filterFrom').value;
                const to = document.getElementById('filterTo').value;
                if (from && to) {
                    return state.rounds.filter(r => {
                        const d = new Date(r.date);
                        return d >= new Date(from) && d <= new Date(to + 'T23:59:59');
                    });
                }
                return state.rounds;
            }
            
            switch (currentFilter) {
                case '3m': fromDate = new Date(now.setMonth(now.getMonth() - 3)); break;
                case '6m': fromDate = new Date(now.setMonth(now.getMonth() - 6)); break;
                case '1y': fromDate = new Date(now.setFullYear(now.getFullYear() - 1)); break;
                default: return state.rounds;
            }
            
            return state.rounds.filter(r => new Date(r.date) >= fromDate);
        }
        
        function getUpDownColorClass(value) {
            if (value === null) return '';
            if (value >= 68) return 'good';
            if (value >= 55) return 'medium';
            return 'bad';
        }
        
        function getThreePuttColorClass(value) {
            if (value === null) return '';
            if (value < 0.60) return 'good';
            if (value <= 0.80) return 'medium';
            return 'bad';
        }
        
        function updateStatsTab() {
            const rounds = getFilteredRounds();
            document.getElementById('statsRoundsCount').textContent = rounds.length;
            
            if (rounds.length === 0) {
                document.getElementById('statsRows').innerHTML = '<div class="empty-state"><div>No rounds in this period</div></div>';
                return;
            }
            
            // Aggregate stats
            let totalScore = 0, totalPar = 0, scores = [];
            let fwHit = 0, fwTotal = 0, girHit = 0, girTotal = 0;
            let totalPutts = 0, holesWithPutts = 0;
            let birdies = 0, eagles = 0;
            let udMade = 0, udAttempts = 0;
            let gettableMade = 0, gettableTotal = 0;
            let par3Score = 0, par3Count = 0, par4Score = 0, par4Count = 0, par5Score = 0, par5Count = 0;
            let threePutts = 0;
            let scrambleSuccess = 0, scrambleAttempts = 0;
            
            rounds.forEach(round => {
                const course = state.courses.find(c => c.id === round.courseId);
                const coursePar = course ? course.pars.reduce((a,b)=>a+b,0) : 72;
                
                if (round.totalScore) {
                    totalScore += round.totalScore;
                    totalPar += coursePar;
                    scores.push(round.totalScore);
                }
                
                round.holes.forEach(h => {
                    if (h.score === null) return;
                    
                    const diff = h.score - h.par;
                    if (diff === -1) birdies++;
                    if (diff <= -2) eagles++;
                    
                    // Auto-calculate GIR
                    const gir = calculateGIR(h.score, h.putts, h.par);
                    girTotal++;
                    if (gir) girHit++;
                    
                    if (h.par >= 4) {
                        fwTotal++;
                        if (h.fairway) fwHit++;
                    }
                    
                    if (h.putts !== null) {
                        totalPutts += h.putts;
                        holesWithPutts++;
                        if (h.putts >= 3) threePutts++;
                    }
                    
                    // Up & down
                    if (h.upDownAttempt) {
                        udAttempts++;
                        if (h.upDownMade === true) udMade++;
                    }
                    
                    // Gettable putts
                    gettableTotal += h.gettableTotal || 0;
                    gettableMade += h.gettableMade || 0;
                    
                    // Par type scoring
                    if (h.par === 3) { par3Score += diff; par3Count++; }
                    if (h.par === 4) { par4Score += diff; par4Count++; }
                    if (h.par === 5) { par5Score += diff; par5Count++; }
                    
                    // Scrambling
                    if (!gir) {
                        scrambleAttempts++;
                        if (diff <= 0) scrambleSuccess++;
                    }
                });
            });
            
            // Calculate averages
            const avgScore = scores.length > 0 ? (totalScore / scores.length).toFixed(1) : '--';
            const avgToPar = scores.length > 0 ? ((totalScore - totalPar) / scores.length).toFixed(1) : null;
            const avgToParStr = avgToPar !== null ? (avgToPar >= 0 ? '+' + avgToPar : avgToPar) : '';
            
            const fwPct = fwTotal > 0 ? Math.round(fwHit / fwTotal * 100) : null;
            const girPct = girTotal > 0 ? Math.round(girHit / girTotal * 100) : null;
            const puttsPerRound = rounds.length > 0 && totalPutts > 0 ? (totalPutts / rounds.length).toFixed(1) : '--';
            const puttsPerHole = holesWithPutts > 0 ? (totalPutts / holesWithPutts).toFixed(2) : '--';
            const gettablePct = gettableTotal > 0 ? Math.round(gettableMade / gettableTotal * 100) : null;
            const udPct = udAttempts > 0 ? Math.round(udMade / udAttempts * 100) : null;
            const birdiesPerRound = rounds.length > 0 ? (birdies / rounds.length).toFixed(1) : '0';
            const threePuttsPerRound = rounds.length > 0 ? (threePutts / rounds.length).toFixed(2) : '--';
            const scramblePct = scrambleAttempts > 0 ? Math.round(scrambleSuccess / scrambleAttempts * 100) : null;
            
            const par3Avg = par3Count > 0 ? (par3Score / par3Count).toFixed(1) : '--';
            const par4Avg = par4Count > 0 ? (par4Score / par4Count).toFixed(1) : '--';
            const par5Avg = par5Count > 0 ? (par5Score / par5Count).toFixed(1) : '--';
            
            // Build stats rows
            const stats = [
                { icon: '‚Äî', name: 'Scoring Avg', you: avgScore, youSub: avgToParStr, pga: '71.5', colorFn: null },
                { icon: '| |', name: 'Fairways', you: fwPct !== null ? fwPct + '%' : '--', youSub: fwTotal > 0 ? `${fwHit} of ${fwTotal}` : '', pga: '60%', color: getColorClass(fwPct, 60) },
                { icon: '‚óâ', name: 'GIR', you: girPct !== null ? girPct + '%' : '--', youSub: girTotal > 0 ? `${girHit} of ${girTotal}` : '', pga: '66%', color: getColorClass(girPct, 66) },
                { icon: '‚óã', name: 'Putts/Round', you: puttsPerRound, youSub: '', pga: '29.0', color: getColorClassInverse(parseFloat(puttsPerRound), 29) },
                { icon: '‚ó¶', name: 'Putts/Hole', you: puttsPerHole, youSub: '', pga: '1.60', color: getColorClassInverse(parseFloat(puttsPerHole), 1.6) },
                { icon: '‚ë¢', name: '3-Putts/Round', you: threePuttsPerRound, youSub: '', pga: '0.49', color: getThreePuttColorClass(parseFloat(threePuttsPerRound)) },
                { icon: '‚óê', name: 'Gettable Putts', nameSub: '4-12ft', you: gettablePct !== null ? gettablePct + '%' : '--', youSub: '', pga: '65%', color: getColorClass(gettablePct, 65) },
                { icon: '‚Üï', name: 'Up & Down', nameSub: '<15m from green', you: udPct !== null ? udPct + '%' : '--', youSub: '', pga: '80%', color: getUpDownColorClass(udPct) },
                { icon: 'üîÑ', emoji: true, name: 'Scrambling', you: scramblePct !== null ? scramblePct + '%' : '--', youSub: '', pga: '59%', color: getColorClass(scramblePct, 59) },
                { icon: 'üê¶', emoji: true, name: 'Birdies/Round', you: birdiesPerRound, youSub: '', pga: '3.9', color: getColorClass(parseFloat(birdiesPerRound) / 3.9 * 100, 100) },
                { icon: '‚ë¢', name: 'Par 3s Avg', you: par3Avg !== '--' ? (parseFloat(par3Avg) >= 0 ? '+' : '') + par3Avg : '--', youSub: '', pga: '+0.1', colorFn: null },
                { icon: '‚ë£', name: 'Par 4s Avg', you: par4Avg !== '--' ? (parseFloat(par4Avg) >= 0 ? '+' : '') + par4Avg : '--', youSub: '', pga: 'E', colorFn: null },
                { icon: '‚ë§', name: 'Par 5s Avg', you: par5Avg !== '--' ? (parseFloat(par5Avg) >= 0 ? '+' : '') + par5Avg : '--', youSub: '', pga: '-0.6', colorFn: null }
            ];
            
            document.getElementById('statsRows').innerHTML = stats.map(s => `
                <div class="stat-row">
                    <div class="stat-left">
                        <div class="stat-icon ${s.emoji ? 'emoji' : ''}">${s.icon}</div>
                        <div>
                            <div class="stat-name">${s.name}</div>
                            ${s.nameSub ? `<div class="stat-name-sub">${s.nameSub}</div>` : ''}
                        </div>
                    </div>
                    <div class="stat-right">
                        <div class="stat-you-container">
                            <div class="stat-you ${s.color || ''}">${s.you}</div>
                            ${s.youSub ? `<div class="stat-you-sub">${s.youSub}</div>` : ''}
                        </div>
                        <span class="stat-pga">${s.pga}</span>
                    </div>
                </div>
            `).join('');
        }
        
        // ==================== HISTORY TAB ====================
        function updateHistoryTab() {
            document.getElementById('historyListView').classList.remove('hide');
            document.getElementById('historyDetail').classList.remove('show');
            
            if (state.rounds.length === 0) {
                document.getElementById('historyList').innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìã</div><div>No rounds recorded yet</div></div>';
                return;
            }
            
            const sorted = [...state.rounds].reverse();
            document.getElementById('historyList').innerHTML = sorted.map((r, idx) => {
                const c = state.courses.find(x => x.id === r.courseId);
                const par = c ? c.pars.reduce((a,b)=>a+b,0) : 72;
                const tp = r.totalScore - par;
                const tpStr = tp === 0 ? 'E' : (tp > 0 ? '+' + tp : tp);
                const d = new Date(r.date);
                return `<div class="list-item" onclick="showHistoryDetail(${state.rounds.length - 1 - idx})">
                    <div>
                        <div class="list-item-title">${r.courseName}</div>
                        <div class="list-item-sub">${d.toLocaleDateString('en-US', { day: 'numeric', month: 'short', year: 'numeric' })}</div>
                    </div>
                    <div class="list-item-right">
                        <div class="list-item-score">${r.totalScore || '--'}</div>
                        <div class="list-item-par">${tpStr}</div>
                    </div>
                </div>`;
            }).join('');
        }
        
        function showHistoryDetail(roundIndex) {
            const round = state.rounds[roundIndex];
            if (!round) return;
            
            document.getElementById('historyListView').classList.add('hide');
            document.getElementById('historyDetail').classList.add('show');
            
            const course = state.courses.find(c => c.id === round.courseId);
            const coursePar = course ? course.pars.reduce((a,b)=>a+b,0) : 72;
            const toPar = round.totalScore - coursePar;
            const toParStr = toPar === 0 ? 'E' : (toPar > 0 ? '+' + toPar : toPar);
            const d = new Date(round.date);
            
            const stats = calculateRoundStats(round);
            
            document.getElementById('historyDetailContent').innerHTML = `
                <div class="summary-header">
                    <div class="summary-title">${d.toLocaleDateString('en-US', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })}</div>
                    <div class="summary-score">${round.totalScore || '--'}</div>
                    <div class="summary-to-par">${toParStr}</div>
                    <div class="summary-course">${round.courseName}</div>
                </div>
                <div class="summary-section-title">Scorecard</div>
                <div class="scorecard-container show" style="margin-bottom:0;">
                    ${generateScorecardHTML(round, course)}
                </div>
                <div class="summary-section-title">Statistics</div>
                <div style="padding: 0 24px 24px;">
                    ${generateStatsHTML(stats)}
                </div>
            `;
        }
        
        function hideHistoryDetail() {
            document.getElementById('historyListView').classList.remove('hide');
            document.getElementById('historyDetail').classList.remove('show');
        }
        
        function showRoundDetail(roundIndex) {
            showTab('historyTab');
            setTimeout(() => showHistoryDetail(roundIndex), 100);
        }
        
        // ==================== COURSES TAB ====================
        function updateCoursesTab() {
            updateCourseSelect();
            
            if (state.courses.length === 0) {
                document.getElementById('coursesList').innerHTML = '<div class="empty-state"><div>No courses added yet</div></div>';
                return;
            }
            
            document.getElementById('coursesList').innerHTML = state.courses.map(c => `
                <div class="course-item">
                    <div>
                        <div class="course-name">${c.name}</div>
                        <div class="course-par">Par ${c.pars.reduce((a,b)=>a+b,0)}</div>
                    </div>
                    <div class="course-delete" onclick="deleteCourse(${c.id})">üóëÔ∏è</div>
                </div>
            `).join('');
        }
        
        function updateCourseSelect() {
            const select = document.getElementById('courseSelect');
            select.innerHTML = '<option value="">Choose a course...</option>' + 
                state.courses.map(c => `<option value="${c.id}">${c.name} (Par ${c.pars.reduce((a,b)=>a+b,0)})</option>`).join('');
        }
        
        function addCourse() {
            const name = document.getElementById('newCourseName').value.trim();
            const parsStr = document.getElementById('newCoursePars').value.trim();
            
            if (!name) { alert('Please enter a course name'); return; }
            if (!parsStr) { alert('Please enter the pars'); return; }
            
            const pars = parsStr.split(',').map(p => parseInt(p.trim())).filter(p => !isNaN(p) && p >= 3 && p <= 5);
            if (pars.length !== 18) { alert('Please enter exactly 18 valid pars (3, 4, or 5)'); return; }
            
            state.courses.push({ id: Date.now(), name, pars });
            saveState();
            
            document.getElementById('newCourseName').value = '';
            document.getElementById('newCoursePars').value = '';
            
            updateCoursesTab();
        }
        
        function deleteCourse(id) {
            if (!confirm('Delete this course?')) return;
            state.courses = state.courses.filter(c => c.id !== id);
            saveState();
            updateCoursesTab();
        }
        
        // ==================== PLAY TAB ====================
        function updatePlayTab() {
            updateCourseSelect();
            if (!state.currentRound) {
                document.getElementById('playSetup').style.display = 'block';
                document.getElementById('playActive').style.display = 'none';
                document.getElementById('mainHeader').style.display = 'block';
            } else {
                document.getElementById('playSetup').style.display = 'none';
                document.getElementById('playActive').style.display = 'block';
                document.getElementById('mainHeader').style.display = 'none';
                renderScorecard();
                renderCurrentHole();
                updateLiveScore();
            }
        }
        
        function onCourseSelect() {
            const val = document.getElementById('courseSelect').value;
            document.getElementById('startRoundBtn').disabled = !val;
        }
        
        function startNewRound() {
            showTab('playTab');
        }
        
        function beginRound() {
            const courseId = parseInt(document.getElementById('courseSelect').value);
            const course = state.courses.find(c => c.id === courseId);
            if (!course) return;
            
            state.currentRound = {
                courseId,
                courseName: course.name,
                date: new Date().toISOString(),
                holes: course.pars.map((par, i) => ({
                    hole: i + 1,
                    par,
                    score: par,
                    fairway: false,
                    putts: 2,
                    gettableMade: 0,
                    gettableTotal: 0,
                    upDownAttempt: false,
                    upDownMade: null,
                    fromBunker: false
                }))
            };
            
            currentHoleIndex = 0;
            scorecardVisible = false;
            saveState();
            updatePlayTab();
        }
        
        function toggleScorecard() {
            scorecardVisible = !scorecardVisible;
            document.getElementById('scorecardContainer').classList.toggle('show', scorecardVisible);
            document.getElementById('scorecardToggleBtn').textContent = scorecardVisible ? 'Hide Scorecard' : 'View Scorecard';
            if (scorecardVisible) renderScorecard();
        }
        
        function renderScorecard() {
            if (!state.currentRound) return;
            const course = state.courses.find(c => c.id === state.currentRound.courseId);
            document.getElementById('classicScorecard').innerHTML = generateScorecardTableContent(state.currentRound, course);
        }
        
        function generateScorecardHTML(round, course) {
            return `<table class="classic-scorecard">${generateScorecardTableContent(round, course)}</table>`;
        }
        
        function generateScorecardTableContent(round, course) {
            const holes = round.holes;
            const front9 = holes.slice(0, 9);
            const back9 = holes.slice(9, 18);
            
            const front9Par = front9.reduce((a, h) => a + h.par, 0);
            const back9Par = back9.reduce((a, h) => a + h.par, 0);
            const totalPar = front9Par + back9Par;
            
            const front9Score = front9.reduce((a, h) => a + (h.score || 0), 0);
            const back9Score = back9.reduce((a, h) => a + (h.score || 0), 0);
            const totalScore = front9Score + back9Score;
            
            function getScoreDisplay(hole) {
                if (hole.score === null) return '-';
                const diff = hole.score - hole.par;
                if (diff <= -2) return `<span class="eagle">${hole.score}</span>`;
                if (diff === -1) return `<span class="birdie">${hole.score}</span>`;
                if (diff === 1) return `<span class="bogey">${hole.score}</span>`;
                if (diff >= 2) return `<span class="double-bogey">${hole.score}</span>`;
                return hole.score;
            }
            
            function getDiffDisplay(hole) {
                if (hole.score === null) return '-';
                const diff = hole.score - hole.par;
                if (diff === 0) return 'E';
                const cls = diff < 0 ? 'under' : 'over';
                return `<span class="${cls}">${diff > 0 ? '+' : ''}${diff}</span>`;
            }
            
            return `
                <tr class="hole-header">
                    <th>Hole</th>
                    ${front9.map(h => `<th>${h.hole}</th>`).join('')}
                    <th class="total-col">Out</th>
                </tr>
                <tr class="par-row">
                    <td>Par</td>
                    ${front9.map(h => `<td>${h.par}</td>`).join('')}
                    <td class="total-col">${front9Par}</td>
                </tr>
                <tr>
                    <td>Score</td>
                    ${front9.map(h => `<td class="score-cell">${getScoreDisplay(h)}</td>`).join('')}
                    <td class="total-col">${front9Score}</td>
                </tr>
                <tr>
                    <td>+/-</td>
                    ${front9.map(h => `<td class="diff-cell">${getDiffDisplay(h)}</td>`).join('')}
                    <td class="total-col diff-cell ${front9Score - front9Par < 0 ? 'under' : front9Score - front9Par > 0 ? 'over' : ''}">${front9Score - front9Par === 0 ? 'E' : (front9Score - front9Par > 0 ? '+' : '') + (front9Score - front9Par)}</td>
                </tr>
                <tr><td colspan="11" style="height:8px;border:none;"></td></tr>
                <tr class="hole-header">
                    <th>Hole</th>
                    ${back9.map(h => `<th>${h.hole}</th>`).join('')}
                    <th class="total-col">In</th>
                </tr>
                <tr class="par-row">
                    <td>Par</td>
                    ${back9.map(h => `<td>${h.par}</td>`).join('')}
                    <td class="total-col">${back9Par}</td>
                </tr>
                <tr>
                    <td>Score</td>
                    ${back9.map(h => `<td class="score-cell">${getScoreDisplay(h)}</td>`).join('')}
                    <td class="total-col">${back9Score}</td>
                </tr>
                <tr>
                    <td>+/-</td>
                    ${back9.map(h => `<td class="diff-cell">${getDiffDisplay(h)}</td>`).join('')}
                    <td class="total-col diff-cell ${back9Score - back9Par < 0 ? 'under' : back9Score - back9Par > 0 ? 'over' : ''}">${back9Score - back9Par === 0 ? 'E' : (back9Score - back9Par > 0 ? '+' : '') + (back9Score - back9Par)}</td>
                </tr>
                <tr><td colspan="11" style="height:8px;border:none;"></td></tr>
                <tr class="hole-header">
                    <th colspan="10" style="text-align:right;">Total</th>
                    <th class="total-col">${totalScore}</th>
                </tr>
            `;
        }
        
        function generateStatsHTML(stats) {
            return `
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                    <div style="background:var(--card-bg);padding:12px;border-radius:10px;">
                        <div style="font-size:10px;color:var(--text-light);text-transform:uppercase;">Fairways</div>
                        <div style="font-size:18px;font-weight:500;">${stats.fwPct !== null ? stats.fwPct + '%' : '--'}</div>
                        <div style="font-size:11px;color:var(--text-faint);">${stats.fwHit} of ${stats.fwTotal}</div>
                    </div>
                    <div style="background:var(--card-bg);padding:12px;border-radius:10px;">
                        <div style="font-size:10px;color:var(--text-light);text-transform:uppercase;">GIR</div>
                        <div style="font-size:18px;font-weight:500;">${stats.girPct !== null ? stats.girPct + '%' : '--'}</div>
                        <div style="font-size:11px;color:var(--text-faint);">${stats.girHit} of ${stats.girTotal}</div>
                    </div>
                    <div style="background:var(--card-bg);padding:12px;border-radius:10px;">
                        <div style="font-size:10px;color:var(--text-light);text-transform:uppercase;">Putts</div>
                        <div style="font-size:18px;font-weight:500;">${stats.totalPutts || '--'}</div>
                        <div style="font-size:11px;color:var(--text-faint);">${stats.puttsPerHole || '--'}/hole</div>
                    </div>
                    <div style="background:var(--card-bg);padding:12px;border-radius:10px;">
                        <div style="font-size:10px;color:var(--text-light);text-transform:uppercase;">Up & Down</div>
                        <div style="font-size:18px;font-weight:500;">${stats.udPct !== null ? stats.udPct + '%' : '--'}</div>
                        <div style="font-size:11px;color:var(--text-faint);">${stats.udMade} of ${stats.udAttempts}</div>
                    </div>
                    <div style="background:var(--card-bg);padding:12px;border-radius:10px;">
                        <div style="font-size:10px;color:var(--text-light);text-transform:uppercase;">Scrambling</div>
                        <div style="font-size:18px;font-weight:500;">${stats.scramblePct !== null ? stats.scramblePct + '%' : '--'}</div>
                        <div style="font-size:11px;color:var(--text-faint);">${stats.scrambleSuccess} of ${stats.scrambleAttempts}</div>
                    </div>
                    <div style="background:var(--card-bg);padding:12px;border-radius:10px;">
                        <div style="font-size:10px;color:var(--text-light);text-transform:uppercase;">Birdies</div>
                        <div style="font-size:18px;font-weight:500;">${stats.birdies}</div>
                        <div style="font-size:11px;color:var(--text-faint);">${stats.eagles > 0 ? '+' + stats.eagles + ' eagles' : ''}</div>
                    </div>
                </div>
            `;
        }
        
        function renderCurrentHole() {
            const hole = state.currentRound.holes[currentHoleIndex];
            
            document.getElementById('currentHoleNum').textContent = hole.hole;
            document.getElementById('currentHolePar').textContent = 'Par ' + hole.par;
            document.getElementById('currentScore').textContent = hole.score;
            
            // Score label
            const diff = hole.score - hole.par;
            let label = 'Par', labelClass = '';
            if (diff <= -2) { label = 'Eagle!'; labelClass = 'eagle'; }
            else if (diff === -1) { label = 'Birdie!'; labelClass = 'birdie'; }
            else if (diff === 1) { label = 'Bogey'; labelClass = 'bogey'; }
            else if (diff === 2) { label = 'Double'; labelClass = 'double-bogey'; }
            else if (diff >= 3) { label = '+' + diff; labelClass = 'double-bogey'; }
            
            document.getElementById('currentScoreLabel').textContent = label;
            document.getElementById('currentScoreLabel').className = 'score-current-label ' + labelClass;
            
            // Fairway (only for par 4 and 5)
            const fwCard = document.getElementById('fairwayCard');
            if (hole.par >= 4) {
                fwCard.style.display = 'block';
                document.getElementById('fairwayYes').className = 'yes-no-btn' + (hole.fairway === true ? ' selected-yes' : '');
                document.getElementById('fairwayNo').className = 'yes-no-btn' + (hole.fairway === false && hole.fairway !== undefined ? ' selected-no' : '');
            } else {
                fwCard.style.display = 'none';
            }
            
            // Putts buttons
            const puttsHtml = [0,1,2,3,4,5].map(p => 
                `<button class="putt-btn ${hole.putts === p ? 'active' : ''}" onclick="setPutts(${p})">${p}</button>`
            ).join('');
            document.getElementById('puttsButtons').innerHTML = puttsHtml;
            
            // Gettable putts
            document.getElementById('gettableMadeValue').textContent = hole.gettableMade || 0;
            document.getElementById('gettableTotalValue').textContent = hole.gettableTotal || 0;
            
            // Up & Down
            const upDownDetails = document.getElementById('upDownDetails');
            const upDownAttemptBtn = document.getElementById('upDownAttemptBtn');
            
            if (hole.upDownAttempt) {
                upDownAttemptBtn.classList.add('selected-yes');
                upDownDetails.classList.add('show');
                
                document.getElementById('upDownMadeYes').className = 'yes-no-btn' + (hole.upDownMade === true ? ' selected-yes' : '');
                document.getElementById('upDownMadeNo').className = 'yes-no-btn' + (hole.upDownMade === false ? ' selected-no' : '');
                document.getElementById('fromBunkerBtn').className = 'yes-no-btn single' + (hole.fromBunker ? ' selected-yes' : '');
            } else {
                upDownAttemptBtn.classList.remove('selected-yes');
                upDownDetails.classList.remove('show');
            }
            
            // Progress
            document.getElementById('progressFill').style.width = ((currentHoleIndex + 1) / 18 * 100) + '%';
            document.getElementById('progressText').textContent = `Hole ${currentHoleIndex + 1} of 18`;
            
            // Next button text
            document.getElementById('nextHoleBtn').textContent = currentHoleIndex === 17 ? 'Finish ‚Üí' : 'Next ‚Üí';
            
            // Update scorecard if visible
            if (scorecardVisible) renderScorecard();
        }
        
        function adjustScore(delta) {
            const hole = state.currentRound.holes[currentHoleIndex];
            const newScore = hole.score + delta;
            if (newScore < 1 || newScore > 15) return;
            
            hole.score = newScore;
            
            // Check for pending celebration (will trigger on next hole)
            const diff = hole.score - hole.par;
            if (diff === -1) {
                pendingCelebration = 'birdie';
            } else if (diff <= -2) {
                pendingCelebration = 'eagle';
            } else {
                pendingCelebration = null;
            }
            
            saveState();
            renderCurrentHole();
            updateLiveScore();
        }
        
        function setFairway(value) {
            state.currentRound.holes[currentHoleIndex].fairway = value;
            saveState();
            renderCurrentHole();
        }
        
        function setPutts(num) {
            state.currentRound.holes[currentHoleIndex].putts = num;
            saveState();
            renderCurrentHole();
        }
        
        function adjustGettableMade(delta) {
            const hole = state.currentRound.holes[currentHoleIndex];
            const newVal = (hole.gettableMade || 0) + delta;
            if (newVal < 0 || newVal > 1) return;
            hole.gettableMade = newVal;
            
            // If made is 1, ensure total is at least 1
            if (newVal === 1 && hole.gettableTotal < 1) {
                hole.gettableTotal = 1;
            }
            
            saveState();
            renderCurrentHole();
        }
        
        function adjustGettableTotal(delta) {
            const hole = state.currentRound.holes[currentHoleIndex];
            const newVal = (hole.gettableTotal || 0) + delta;
            if (newVal < 0) return;
            
            // Can't reduce total below made
            if (newVal < hole.gettableMade) return;
            
            hole.gettableTotal = newVal;
            saveState();
            renderCurrentHole();
        }
        
        function setUpDownAttempt() {
            const hole = state.currentRound.holes[currentHoleIndex];
            hole.upDownAttempt = !hole.upDownAttempt;
            if (!hole.upDownAttempt) {
                hole.upDownMade = null;
                hole.fromBunker = false;
            }
            saveState();
            renderCurrentHole();
        }
        
        function setUpDownMade(value) {
            state.currentRound.holes[currentHoleIndex].upDownMade = value;
            saveState();
            renderCurrentHole();
        }
        
        function setFromBunker() {
            const hole = state.currentRound.holes[currentHoleIndex];
            hole.fromBunker = !hole.fromBunker;
            saveState();
            renderCurrentHole();
        }
        
        function updateLiveScore() {
            let total = 0, par = 0;
            state.currentRound.holes.forEach(h => {
                if (h.score !== null) {
                    total += h.score;
                    par += h.par;
                }
            });
            const diff = total - par;
            document.getElementById('liveScore').textContent = diff === 0 ? 'E' : (diff > 0 ? '+' + diff : diff);
        }
        
        function prevHole() {
            if (currentHoleIndex > 0) {
                currentHoleIndex--;
                pendingCelebration = null;
                renderCurrentHole();
            }
        }
        
        function nextHole() {
            // Trigger celebration if pending
            if (pendingCelebration) {
                showCelebration(pendingCelebration);
                pendingCelebration = null;
            }
            
            if (currentHoleIndex < 17) {
                currentHoleIndex++;
                renderCurrentHole();
            } else {
                finishRound();
            }
        }
        
        function finishRound() {
            if (!confirm('Finish and save this round?')) return;
            
            let total = 0;
            state.currentRound.holes.forEach(h => total += h.score);
            state.currentRound.totalScore = total;
            
            const finishedRound = { ...state.currentRound };
            state.rounds.push(finishedRound);
            state.currentRound = null;
            
            saveState();
            
            document.getElementById('courseSelect').value = '';
            document.getElementById('startRoundBtn').disabled = true;
            
            // Show round summary
            showRoundSummary(finishedRound);
        }
        
        function showRoundSummary(round) {
            const course = state.courses.find(c => c.id === round.courseId);
            const coursePar = course ? course.pars.reduce((a,b)=>a+b,0) : 72;
            const toPar = round.totalScore - coursePar;
            const toParStr = toPar === 0 ? 'E' : (toPar > 0 ? '+' + toPar : toPar);
            const d = new Date(round.date);
            
            document.getElementById('summaryScore').textContent = round.totalScore;
            document.getElementById('summaryToPar').textContent = toParStr;
            document.getElementById('summaryCourse').textContent = `${round.courseName} ¬∑ ${d.toLocaleDateString('en-US', { day: 'numeric', month: 'short', year: 'numeric' })}`;
            
            document.getElementById('summaryScorecard').innerHTML = generateScorecardTableContent(round, course);
            
            const stats = calculateRoundStats(round);
            document.getElementById('summaryStats').innerHTML = generateStatsHTML(stats);
            
            // Hide everything else, show summary
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById('mainNav').style.display = 'none';
            document.getElementById('mainHeader').style.display = 'none';
            document.getElementById('roundBanner').classList.remove('show');
            document.getElementById('roundSummary').classList.add('active');
        }
        
        function closeSummary() {
            document.getElementById('roundSummary').classList.remove('active');
            document.getElementById('mainNav').style.display = 'flex';
            showTab('historyTab');
        }
        
        // ==================== CELEBRATION ====================
        function showCelebration(type) {
            if (!state.profile.soundEnabled) return;
            
            const overlay = document.getElementById('celebration');
            const icon = document.getElementById('celebrationIcon');
            const text = document.getElementById('celebrationText');
            
            if (type === 'birdie') {
                icon.textContent = 'üê¶';
                text.textContent = '"Tweet tweet"';
                document.getElementById('birdieSound').play().catch(() => {});
                overlay.classList.add('show');
                setTimeout(() => overlay.classList.remove('show'), 2000);
            } else if (type === 'eagle') {
                icon.textContent = 'ü¶Ö';
                text.textContent = '"KREEEEE!"';
                document.getElementById('eagleSound').play().catch(() => {});
                overlay.classList.add('show');
                setTimeout(() => overlay.classList.remove('show'), 3500);
            }
        }
        
        // ==================== INIT ====================
        function init() {
            loadState();
            updateGreeting();
            updateProfileBtn();
            updateHomeTab();
            updateCourseSelect();
            
            // Check for in-progress round
            if (state.currentRound) {
                showTab('playTab');
            }
            
            // Register service worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js').catch(e => console.log('SW error:', e));
            }
        }
        
        init();
    </script>
</body>
</html>
